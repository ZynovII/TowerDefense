# Tower Defense: Cyberpunk Edition — Work Plan

## Тематика: Cyberpunk / Neon

**Визуальный стиль**: Тёмный фон (#0a0a1a), неоновые акценты (cyan #00fff0, magenta #ff00ff, lime #39ff14), глитч-эффекты, пиксельные тени.

**Башни (переосмысление)**:
- Green Tower → **Plasma Turret** — зелёный неоновый лазер
- Blue Tower → **Cryo Module** — ледяной синий замораживатель с эффектом статики
- White Tower → **EMP Cannon** — красно-белая пушка мгновенного уничтожения

**Враги**: Дроны, боты, мехи — SVG с неоновыми контурами и анимацией свечения.

**Карта**: Улицы ночного мегаполиса, неоновые вывески, дорога из голографических плиток.

**Звук**: Synthwave-лупы, электронные звуки выстрелов, глитч-звук смерти врага.

---

## Фаза 0 — Инфраструктура и автоматизация (Неделя 1)

### 0.1 Claude Code Agent Skills (`.claude/skills/`)

Создать пользовательские навыки для ускорения рутинных задач:

#### Skill: `add-level`
**Цель**: Быстрое добавление нового уровня в `ModelGame.levels[]`
```
Промпт: принимает параметры (units, cells, speed, hp, frequency),
валидирует баланс относительно предыдущего уровня,
вставляет объект в массив levels, обновляет CLAUDE.md
```

#### Skill: `add-tower`
**Цель**: Создание нового типа башни по шаблону
```
Промпт: принимает (name, color, cost, damage, projectileClass, svgTemplate),
генерирует ModelXxxTower extends Tower, ViewXxxTower extends ViewTower,
новый класс снаряда в Shells.js,
добавляет drag-handler в ModelGame.js,
добавляет SVG-палитру в ViewGame.js,
обновляет index.html (если нужен новый файл)
```

#### Skill: `add-enemy`
**Цель**: Создание нового типа врага
```
Промпт: принимает (name, hp, speed, svgTemplate, specialAbility),
расширяет ModelEnemy или создаёт подкласс,
добавляет ViewEnemy вариант,
обновляет спавн-логику в ModelGame
```

#### Skill: `balance-check`
**Цель**: Анализ баланса уровней
```
Промпт: читает levels[], стоимости башен, урон снарядов,
рассчитывает TTK (time-to-kill), DPS башен, EHP волн,
выводит таблицу баланса и рекомендации
```

#### Skill: `gen-svg`
**Цель**: Генерация SVG-спрайтов в cyberpunk-стиле
```
Промпт: принимает описание объекта (tower/enemy/ui-element),
генерирует SVG-код с неоновыми цветами, glow-фильтрами,
сохраняет в img/
```

### 0.2 Git Hooks и CI (`.claude/hooks/`)

#### SessionStart Hook
```bash
# Проверяет, что сервер доступен, и открывает preview
python3 -m http.server 8000 &
echo "Dev server: http://localhost:8000"
```

#### Pre-commit Hook
```bash
# Валидация: все JS-файлы из index.html существуют
# Проверка: нет console.log в продакшн-коде (кроме ControllerGame)
# Проверка: levels[] сортирован по сложности (units * unitsHP / cells растёт)
```

#### Post-push Automation
```bash
# Деплой на GitHub Pages / Netlify
# Генерация changelog из коммитов
# Уведомление в Telegram/Discord о новой версии
```

### 0.3 Автоматизация релизов

**GitHub Actions Pipeline**:
```
on push to main:
  1. Минификация JS (terser)
  2. Минификация CSS (cssnano)
  3. Инлайн критических ресурсов
  4. Деплой на GitHub Pages
  5. Создание GitHub Release с changelog
  6. Сборка Capacitor APK (для мобильной версии)
```

---

## Фаза 1 — Визуальный ребрендинг в Cyberpunk (Недели 2-3)

### 1.1 CSS-тема
- [ ] Тёмный фон, неоновые цвета, шрифт (Orbitron / Share Tech Mono)
- [ ] CSS glow-эффекты для башен и UI (`box-shadow`, `text-shadow`, `filter: drop-shadow`)
- [ ] Анимации: пульсация башен, мерцание неона, глитч-эффект на заголовке
- [ ] Адаптивная вёрстка для мобильных (touch-friendly кнопки, viewport units)

### 1.2 SVG-спрайты (AI-генерация)
- [ ] 3 типа башен в cyberpunk-стиле (с SVG `<filter>` для glow)
- [ ] 3-5 типов врагов (дроны, боты, мехи) с анимацией движения
- [ ] Фон карты: неоновая сетка, здания-силуэты
- [ ] UI-элементы: кнопки, меню, полоска HP

### 1.3 Аудио
- [ ] 3-5 synthwave-лупов для фоновой музыки (royalty-free или AI-генерация через Suno/Udio)
- [ ] Звуковые эффекты: выстрелы, взрывы, freeze, UI-клики
- [ ] Web Audio API для воспроизведения (без внешних зависимостей)

---

## Фаза 2 — Геймплей и контент (Недели 4-6)

### 2.1 Уровни: расширение до 20
- [ ] Уровни 1-5: обучающие (текущие, ребалансированные)
- [ ] Уровни 6-10: новые типы врагов (быстрые дроны, танки с бронёй)
- [ ] Уровни 11-15: комбинированные волны, ускорение
- [ ] Уровни 16-20: босс-волны (один сильный враг + свита)

### 2.2 Мета-прогрессия
- [ ] Монеты (credits) — валюта между раундами
- [ ] Апгрейды башен: урон +10%, скорость стрельбы +15%, дальность +20%
- [ ] Разблокировка новых типов башен через прогресс
- [ ] localStorage для сохранения прогресса

### 2.3 Новые механики
- [ ] Способности башен (active skills) по кулдауну
- [ ] Комбо-система: несколько башен рядом = бонус
- [ ] Волны с мини-боссами каждые 5 уровней

---

## Фаза 3 — Аналитика и метрики (Неделя 5, параллельно)

### 3.1 Сбор данных (клиентская часть)

**Модуль `Analytics.js`** — легковесный трекер событий:
```javascript
// Отслеживаемые события:
// - session_start (device, screen, browser)
// - level_start (level_id, score, towers_owned)
// - level_complete (level_id, time_spent, towers_used, enemies_leaked)
// - level_fail (level_id, time_spent, cause)
// - tower_place (tower_type, position, score_at_time)
// - tower_upgrade (tower_type, upgrade_level)
// - enemy_kill (enemy_type, tower_type, time_in_level)
// - enemy_leak (enemy_type, remaining_hp)
// - session_end (total_time, max_level, final_score)
// - iap_view / iap_purchase (item_id, price) — для мобильной версии
```

**Хранение**: Батчинг событий в localStorage → отправка на бэкенд каждые 30 секунд или при `beforeunload`.

### 3.2 Бэкенд для метрик

**Вариант A (минимальный)**: Google Sheets API + Google Apps Script
- Бесплатно
- Данные сразу в таблице для анализа

**Вариант B (масштабируемый)**: Supabase (бесплатный tier)
- PostgreSQL для структурированных данных
- REST API из коробки
- 500MB бесплатно — хватит на миллионы событий

### 3.3 AI-отчёты (автоматизация)

#### Skill: `metrics-report`
**Цель**: Генерация еженедельного отчёта по метрикам
```
Промпт:
1. Fetch данные из Supabase/Google Sheets за последние 7 дней
2. Рассчитать ключевые метрики:
   - DAU / WAU / MAU
   - D1, D7 retention
   - Avg session length
   - Level completion funnel
   - Tower usage distribution
   - Revenue (если есть IAP)
3. Сравнить с предыдущей неделей (тренды)
4. Определить проблемные точки (уровни с >50% churn)
5. Сгенерировать рекомендации по балансу
6. Вывести Markdown-отчёт
```

#### Skill: `balance-suggest`
**Цель**: AI-рекомендации по балансу на основе данных
```
Промпт:
1. Читает текущие levels[] и tower stats
2. Анализирует данные о прохождении уровней
3. Находит: слишком лёгкие (>95% completion), слишком сложные (<50%)
4. Предлагает конкретные изменения: HP врагов, кол-во, скорость
5. Симулирует баланс (DPS vs EHP per wave)
```

### 3.4 Dashboard

Простой HTML-дашборд (`/admin/dashboard.html`):
- Графики retention (Chart.js)
- Воронка уровней
- Heatmap размещения башен
- Revenue трекер
- Обновляется автоматически из бэкенда метрик

---

## Фаза 4 — Публикация на Web-порталах (Неделя 7)

### 4.1 Poki SDK интеграция
- [ ] `PokiSDK.init()` при загрузке
- [ ] `commercialBreak()` между уровнями
- [ ] `rewardedBreak()` за бонусные credits
- [ ] `gameplayStart()` / `gameplayStop()` для трекинга

### 4.2 CrazyGames SDK
- [ ] Аналогичная интеграция
- [ ] Адаптация UI под их требования (брендинг, кнопка "ещё игры")

### 4.3 Оптимизация
- [ ] Lazy-loading звуков и тяжёлых SVG
- [ ] `requestAnimationFrame` вместо `setInterval` для game loop
- [ ] Object pooling для снарядов и врагов (GC-оптимизация)

---

## Фаза 5 — Мобильная версия (Недели 8-10)

### 5.1 Capacitor обёртка
- [ ] `npm init` + Capacitor setup
- [ ] Адаптация touch-событий (уже есть pointer events)
- [ ] Экраны под разные разрешения (CSS viewport units)

### 5.2 Монетизация (AdMob + IAP)
- [ ] Rewarded Ads: x2 credits за просмотр
- [ ] Interstitial: между уровнями (каждые 3 уровня)
- [ ] IAP: Remove Ads ($2.99), Starter Pack ($4.99), Premium Towers ($1.99)

### 5.3 ASO (App Store Optimization)
- [ ] Ключевые слова: "tower defense cyberpunk", "neon TD", "cyber defense"
- [ ] 5 скриншотов с неоновым стилем
- [ ] Иконка: неоновая башня на тёмном фоне

---

## Таймлайн → $3-5K/мес

```
Неделя  1: Инфраструктура, skills, автоматизация         ████
Неделя  2: CSS cyberpunk тема, SVG спрайты               ████
Неделя  3: Аудио, анимации, polish                       ████
Неделя  4: Уровни 6-20, мета-прогрессия                  ████
Неделя  5: Аналитика, новые механики                     ████
Неделя  6: Баланс (по данным плейтестов)                 ████
Неделя  7: Публикация Poki + CrazyGames      → $300/мес ████
Неделя  8: Capacitor, мобильная адаптация                ████
Неделя  9: AdMob, IAP, тестирование                      ████
Неделя 10: Google Play релиз               → $1,500/мес ████
Неделя 14: iOS релиз + Battle Pass         → $3,500/мес ████
Неделя 18: Масштабирование, новый контент  → $5,000/мес ████
```

---

## Приоритет задач (что делать первым)

1. **Фаза 0** — без автоматизации всё остальное будет медленнее
2. **Фаза 1.1** (CSS) — быстро меняет восприятие игры, мотивирует
3. **Фаза 2.1** (уровни) — контент = retention = деньги
4. **Фаза 3.1** (аналитика) — без данных невозможно оптимизировать
5. **Фаза 4** (веб-порталы) — первый доход и реальные данные
6. **Фаза 5** (мобилки) — основной источник дохода
